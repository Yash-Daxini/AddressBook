@{
    ViewData["Title"] = "InsertOrUpdate";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@model AddressBook.Areas.MST_Contact.Models.MST_ContactModel;

<div class="container w-50 my-5">
    <form method="post" asp-area="MST_Contact" asp-controller="Home" asp-action="Save" enctype="multipart/form-data">

        @Html.HiddenFor(x=>x.ContactID)

        @Html.HiddenFor(x=>x.PhotoPath)

        <div class="mb-3">
            <label class="form-label">Enter Name</label>
            <input type="text" class="form-control my-2" asp-for="ContactName" placeholder="Name" />
            <span asp-validation-for="ContactName" class="text-danger"></span>
        </div>


        <div class="mb-3">
            <label class="form-label">Enter Mobile Number </label>
            <input type="text" class="form-control my-2" asp-for="ContactMobileNumber" placeholder="Mobile Number" />
            <span asp-validation-for="ContactMobileNumber" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label class="form-label">Enter Address</label>
            <input type="text" class="form-control my-2" asp-for="ContactAddress" placeholder="Address" />
            <span asp-validation-for="ContactAddress" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label class="form-label">Enter Email</label>
            <input type="text" class="form-control my-2" asp-for="ContactEmail" placeholder="Email" />
            <span asp-validation-for="ContactEmail" class="text-danger"></span>
        </div>

        @*@if (ViewBag.CountryList != null)*@
        @*{*@

            <div class="mb-3">
                <label class="form-label">Country</label>
                <Select type="text" class="form-control my-2" asp-for="CountryID" asp-items="@(new SelectList(ViewBag.CountryList,"CountryID","CountryName"))" onchange="funOnStateChange();">
                    <option value="">Select Country</option>
                </Select>
                <span asp-validation-for="CountryID" class="text-danger"></span>
            </div>
        @*}*@

        @*@if (ViewBag.StateList != null)*@
        @*{*@
            <div class="mb-3">
                <label class="form-label">State</label>
                <Select type="text" class="form-control my-2" asp-for="StateID" asp-items="@(new SelectList(ViewBag.StateList,"StateID","StateName"))" onchange="funOnCityChange();">
                    <option value="">Select State</option>
                </Select>
                <span asp-validation-for="StateID" class="text-danger"></span>
            </div>
        @*}*@

        @*@if (ViewBag.CityList != null)
        {*@

            <div class="mb-3">
                <label class="form-label">City</label>
                <Select type="text" class="form-control my-2" asp-for="CityID" asp-items="@(new SelectList(ViewBag.CityList,"CityID","CityName"))">
                    <option value="">Select City</option>
                </Select>
                <span asp-validation-for="CityID" class="text-danger"></span>
            </div>
        @*}*@

        @*@if (ViewBag.ContactCategoryDropDownList != null)
        {*@

            <div class="mb-3">
                <label class="form-label">Category</label>
                <Select type="text" class="form-control my-2" asp-for="ContactCategoryID" asp-items="@(new SelectList(ViewBag.ContactCategoryList,"ContactCategoryID","ContactCategoryName"))">
                    <option value="">Select Category</option>
                </Select>
                <span asp-validation-for="ContactCategoryID" class="text-danger"></span>
            </div>
        @*}*@

        <div class="mb-3">
            <label class="form-label">Profile Photo</label>
            @if (ViewBag.EditImageURL != null)
            {
                <td><img id="blah" src="@Url.Content(ViewBag.EditImageURL)" style="width:50px;height:50px;border-radius:40px" /></td>
            }
            <input type="file" class="form-control my-2" asp-for="File" placeholder="Upload Image" />
            <span asp-validation-for="File" class="text-danger"></span>
        </div>

        @Html.HiddenFor(x=>x.CreationDate)

        @Html.HiddenFor(x=>x.ModificationDate)

        <input type="submit" class="btn btn-outline-success" value="Save" />
        <a class="btn btn-outline-danger mx-5" asp-area="MST_Contact" asp-controller="Home" asp-action="Index">Cancel</a>
    </form>

</div>
@section Scripts{
    <script>

        function funOnStateChange() {
            var CountryID = $("#CountryID").val();

            $("#StateID").empty();
            $("#StateID").append($("<option></option>").val("").html("Select State"));
            $("#CityID").empty();
            $("#CityID").append($("<option></option>").val("").html("Select City"));
            if (CountryID !== "") {
                $.ajax(
                    {
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        url: "@Url.Action("StateDropdownByCountry","Home")" + "?&CountryID=" + CountryID,
                        data: {},
                        dataType: "json",
                        success: function (Result) {
                            $.each(Result, function (key, value) {
                                $("#StateID").append($("<option></option>").val(value.stateID).html(value.stateName));
                            });
                        },
                        error: function (err) {
                            //alert(err.toString();
                            alert("Error while fetch data");
                        }
                    }
                )
            }
        }
        function funOnCityChange() {
            var StateID = $("#StateID").val();

            $("#CityID").empty();
            $("#CityID").append($("<option></option>").val("").html("Select City"));
            if (StateID !== "") {
                $.ajax(
                    {
                        type: "POST",
                        contentType: "application/json; charset=utf-8",
                        url: "@Url.Action("CityDropdownByState","Home")" + "?&StateID=" + StateID,
                        data: {},
                        dataType: "json",
                        success: function (Result) {
                            $.each(Result, function (key, value) {
                                $("#CityID").append($("<option></option>").val(value.cityID).html(value.cityName));
                            });
                        },
                        error: function (err) {
                            alert("Error white fetch data");
                        }
                    }
                )
            }
        }


        //Display Preview of selected image
        FileUPT.onchange = evt => {
            const [file] = FileUPT.files
            if (file) {
                blah.src = URL.createObjectURL(file);
            }
        }

    </script>
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}